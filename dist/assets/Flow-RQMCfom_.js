import"./modulepreload-polyfill-B5Qt9EMX.js";let d=[],V=[],G=[],s=0,T="grid",p="active",f="",o=[],v=!1,m,u,q,R,N,B,h,W;const L="http://www.w3.org/2000/svg";function Q(e,t,n){const a=document.createElementNS(L,"svg");return a.setAttribute("viewBox",e),t.forEach(r=>{const w=document.createElementNS(L,"path");w.setAttribute("d",r.d),a.appendChild(w)}),a}function X(){const e=document.createElementNS(L,"svg");e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2");const t=document.createElementNS(L,"line");t.setAttribute("x1","18"),t.setAttribute("y1","6"),t.setAttribute("x2","6"),t.setAttribute("y2","18"),e.appendChild(t);const n=document.createElementNS(L,"line");return n.setAttribute("x1","6"),n.setAttribute("y1","6"),n.setAttribute("x2","18"),n.setAttribute("y2","18"),e.appendChild(n),e}function Y(){const e=document.createElementNS(L,"svg");e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("stroke-width","2");const t=document.createElementNS(L,"path");t.setAttribute("d","M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"),e.appendChild(t);const n=document.createElementNS(L,"path");return n.setAttribute("d","M3 3v5h5"),e.appendChild(n),e}function ee(){return Q("0 0 24 24",[{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"}])}function te(){return Q("0 0 24 24",[{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"}])}async function ne(){console.log("[FLOW POPUP] Initializing..."),m=document.getElementById("tab-flow-grid"),u=document.querySelector(".tab-flow-search"),q=document.querySelector('[data-view="grid"]'),R=document.querySelector('[data-view="list"]'),N=document.querySelector(".tab-flow-section-title"),B=document.querySelector(".search-tab-hint"),h=document.querySelector(".tab-flow-help"),W=document.querySelector(".tab-flow-container"),document.querySelector(".tab-flow-backdrop")?.addEventListener("click",()=>window.close());try{(await chrome.storage.local.get(["TabFlowViewMode"])).TabFlowViewMode==="list"&&(T="list",q.classList.remove("active"),R.classList.add("active"))}catch{}try{const t=await chrome.storage.session.get(["FlowTabData"]);if(t.FlowTabData){const n=t.FlowTabData;d=n.tabs,V=[...d],G=n.groups,o=[...d];const a=d.findIndex(r=>r.active);s=a>=0?Math.min(a+1,d.length-1):0,U(),b(),k(),chrome.storage.session.remove(["FlowTabData"])}else await $()}catch(t){console.error("[FLOW POPUP] Failed to load tab data:",t),await $()}ce(),setTimeout(()=>u.focus(),50)}async function $(){try{const e=await chrome.runtime.sendMessage({action:"getTabsForFlow"});if(e&&e.tabs){d=e.tabs,V=[...d],G=e.groups||[],o=[...d];const t=d.findIndex(n=>n.active);s=t>=0?Math.min(t+1,d.length-1):0,U(),b(),k()}}catch(e){console.error("[FLOW POPUP] Failed to request tabs:",e)}}function ce(){u.addEventListener("input",O),u.addEventListener("keydown",oe),q.addEventListener("click",()=>H("grid")),R.addEventListener("click",()=>H("list")),document.addEventListener("keydown",ae),m.addEventListener("click",se),document.addEventListener("keydown",e=>{e.key==="Escape"&&window.close()}),chrome?.runtime?.onMessage&&chrome.runtime.onMessage.addListener((e,t,n)=>e?.action==="FlowPopupCycleNext"?(S(),b(),n?.({success:!0}),!0):!1)}function O(e){const t=u.value;f=t.toLowerCase().trim();const n=f.length>0||p==="recent"||v;B.classList.toggle("hidden",n);const a=e instanceof InputEvent&&e.inputType==="deleteContentBackward";if(t==="."&&!a){u.value="",f="",p==="recent"?Z():ue();return}if(p!=="recent"&&v){o=[{id:-1,title:f?`Search Web for "${f}"`:"Type to search web...",url:f?`https://www.google.com/search?q=${encodeURIComponent(f)}`:"",favIconUrl:"https://www.google.com/favicon.ico",screenshot:null,pinned:!1,index:0,active:!1,isWebSearch:!0,searchQuery:f}],s=0,N.textContent="Web Search",m.classList.add("search-mode"),m.classList.remove("recent-mode"),W.classList.add("shrink-mode"),U(),b();return}m.classList.remove("search-mode"),W.classList.remove("shrink-mode"),N.textContent=p==="recent"?"Recently Closed":"Opened Tabs",f?(o=d.filter(r=>r.title.toLowerCase().includes(f)||r.url&&r.url.toLowerCase().includes(f)),N.textContent=`Results (${o.length})`,m.classList.add("search-mode")):(o=[...d],N.textContent=p==="recent"?"Recently Closed":"Opened Tabs",m.classList.remove("search-mode")),s=0,U(),b()}function oe(e){if((e.key==="q"||e.key==="Q")&&e.altKey){e.preventDefault(),e.stopPropagation(),S();return}if(e.key==="Tab"&&!e.shiftKey){e.preventDefault(),e.stopPropagation();const t=u.value.trim();if(p==="recent")S();else if(t.length===0)v=!v,O(),k(),u.focus();else if(v&&t){const n=`https://www.google.com/search?q=${encodeURIComponent(t)}`;chrome.tabs.create({url:n}),window.close()}else{const n=`https://www.google.com/search?q=${encodeURIComponent(t)}`;chrome.tabs.create({url:n}),window.close()}}}function ae(e){if((e.key==="q"||e.key==="Q")&&e.altKey){e.preventDefault(),e.stopPropagation(),S();return}if(e.key==="Tab"&&!e.shiftKey){e.preventDefault(),e.stopPropagation();const t=u.value.trim();if(p==="recent")S();else if(t.length===0)v=!v,O(),k(),u.focus();else{const n=`https://www.google.com/search?q=${encodeURIComponent(t)}`;chrome.tabs.create({url:n}),window.close()}return}if(e.key==="Tab"&&e.shiftKey){e.preventDefault(),e.stopPropagation(),z();return}if(e.key==="Backspace"&&u.value===""){if(v){v=!1,O(),k();return}if(p==="recent"){Z();return}}if(!(document.activeElement===u&&!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter","Escape","Delete"].includes(e.key)))switch(e.key){case"ArrowUp":e.preventDefault(),z();break;case"ArrowDown":e.preventDefault(),S();break;case"ArrowLeft":e.preventDefault(),T==="grid"&&!f&&!v&&p!=="recent"?re():z();break;case"ArrowRight":e.preventDefault(),T==="grid"&&!f&&!v&&p!=="recent"?ie():S();break;case"Enter":e.preventDefault(),de();break;case"Delete":p!=="recent"&&(document.activeElement!==u||u.value==="")&&(e.preventDefault(),me());break}}function se(e){const t=e.target,n=t.closest(".tab-card");if(!n)return;if(n.classList.contains("web-search-card")){const w=u.value.trim();if(w){const A=`https://www.google.com/search?q=${encodeURIComponent(w)}`;chrome.tabs.create({url:A}),window.close()}return}const a=n.dataset.sessionId;if(a){e.stopPropagation(),j(a);return}const r=parseInt(n.dataset.tabId||"0",10);if(r){if(t.closest(".tab-close-btn")){e.stopPropagation(),J(r);return}_(r)}}function S(){if(o.length!==0){if(T==="grid"&&!f){le();const e=s+1;s=e>=o.length?0:e}else s=(s+1)%o.length;b()}}function z(){if(o.length!==0){if(T==="grid"&&!f){const e=s-1;s=e<0?o.length-1:e}else s=s<=0?o.length-1:s-1;b()}}function re(){if(o.length===0)return;const e=s-1;s=e<0?o.length-1:e,b()}function ie(){if(o.length===0)return;const e=s+1;s=e>=o.length?0:e,b()}function le(){const e=m.clientWidth-24;return Math.max(1,Math.floor(e/(200+10)))}function de(){if(o.length===0)return;const e=o[s];if(e){if(e.isWebSearch){e.searchQuery&&e.url&&(chrome.tabs.create({url:e.url}),window.close());return}if(e.sessionId){j(e.sessionId);return}e.id>0&&_(e.id)}}async function _(e){try{await chrome.tabs.update(e,{active:!0});const t=await chrome.tabs.get(e);t.windowId&&await chrome.windows.update(t.windowId,{focused:!0}),window.close()}catch(t){console.error("[FLOW POPUP] Failed to switch tab:",t)}}function Z(){p!=="active"&&(p="active",v=!1,d=[...V],o=[...d],s=0,m.classList.remove("recent-mode"),m.classList.remove("search-mode"),W.classList.remove("shrink-mode"),N.textContent="Opened Tabs",u.value="",f="",B.classList.remove("hidden"),U(),b(),k(),u.focus())}async function ue(){if(p!=="recent"){p="recent",v=!1;try{const e=await chrome.runtime.sendMessage({action:"getRecentlyClosed",maxResults:10});e?.success&&e.items?(d=e.items.map((n,a)=>({id:-1,title:n.title||"Untitled",url:n.url||"",favIconUrl:n.favIconUrl||"",screenshot:null,pinned:!1,index:a,active:!1,sessionId:n.sessionId})),o=[...d]):(d=[],o=[])}catch(e){console.error("[FLOW POPUP] Failed to load recently closed:",e),d=[],o=[]}s=0,m.classList.add("recent-mode"),m.classList.remove("search-mode"),N.textContent="Recently Closed",u.value="",f="",B.classList.add("hidden"),U(),b(),k(),u.focus()}}async function j(e){try{await chrome.runtime.sendMessage({action:"restoreSession",sessionId:e}),window.close()}catch(t){console.error("[FLOW POPUP] Failed to restore session:",t)}}function k(){if(!h)return;h.textContent="";const e=(t,n)=>{const a=document.createElement("span");return t.forEach(r=>{const w=document.createElement("kbd");w.textContent=r,a.appendChild(w),a.appendChild(document.createTextNode(" "))}),a.appendChild(document.createTextNode(n)),a};p==="recent"?(h.appendChild(e(["â†‘â†“"],"Navigate")),h.appendChild(e(["â†µ"],"Restore")),h.appendChild(e([".","Backspace"],"Active Tabs")),h.appendChild(e(["Esc"],"Exit"))):v?(h.appendChild(e(["Tab"],"Exit Search Mode")),h.appendChild(e(["â†µ"],"Search Google")),h.appendChild(e(["Backspace"],"Exit")),h.appendChild(e(["Esc"],"Exit"))):(h.appendChild(e(["Alt+Q","â†‘â†“"],"Navigate")),h.appendChild(e(["â†µ"],"Switch")),h.appendChild(e(["Del"],"Close")),h.appendChild(e(["."],"Recent")),h.appendChild(e(["Tab"],"Web Search")),h.appendChild(e(["Esc"],"Exit")))}async function J(e){try{await chrome.tabs.remove(e),d=d.filter(t=>t.id!==e),o=o.filter(t=>t.id!==e),s>=o.length&&(s=Math.max(0,o.length-1)),U(),b(),o.length===0&&window.close()}catch(t){console.error("[FLOW POPUP] Failed to close tab:",t)}}function me(){if(o.length===0)return;const e=o[s];e&&J(e.id)}function H(e){T=e,q.classList.toggle("active",e==="grid"),R.classList.toggle("active",e==="list"),m.classList.toggle("list-view",e==="list");try{chrome.storage.local.set({TabFlowViewMode:e})}catch{}b()}function b(){m.querySelectorAll(".tab-card.selected").forEach(t=>{t.classList.remove("selected")});const e=m.querySelectorAll(".tab-card");e[s]&&(e[s].classList.add("selected"),e[s].scrollIntoView({block:"nearest",behavior:"smooth"}))}function U(){if(m.innerHTML="",m.classList.toggle("list-view",T==="list"),o.length===0){const e=p==="recent"?"No recently closed tabs":v?"Type to search the web...":"No tabs found",t=p==="recent"?"ðŸ“‹":v?"ðŸŒ":"ðŸ”",n=document.createElement("div");n.className="tab-flow-empty";const a=document.createElement("div");a.className="empty-icon",a.textContent=t,n.appendChild(a);const r=document.createElement("div");r.textContent=e,n.appendChild(r),m.appendChild(n);return}o.forEach((e,t)=>{const n=pe(e,t);m.appendChild(n)})}function pe(e,t){const n=document.createElement("div");if(e.isWebSearch){n.className="tab-card web-search-card",n.dataset.index=String(t);const c=document.createElement("div");c.className="tab-thumbnail";const i=document.createElement("div");i.className="favicon-tile";const g=document.createElement("img");g.className="favicon-large",g.src="https://www.google.com/favicon.ico",g.alt="Google",g.onerror=()=>{i.textContent="";const I=document.createElement("div");I.className="favicon-letter",I.textContent="G",i.appendChild(I)},i.appendChild(g),c.appendChild(i),n.appendChild(c);const y=document.createElement("div");y.className="tab-info";const E=document.createElement("div");E.className="tab-title-row";const x=document.createElement("img");x.className="tab-favicon",x.src="https://www.google.com/favicon.ico",x.alt="",E.appendChild(x);const l=document.createElement("span");l.className="tab-title",l.textContent=e.title,E.appendChild(l),y.appendChild(E);const C=document.createElement("div");return C.className="tab-url",C.textContent=e.searchQuery?"Press Enter to search Google":"Type your search query...",y.appendChild(C),n.appendChild(y),n}if(e.sessionId){n.className="tab-card recent-item",n.dataset.sessionId=e.sessionId,n.dataset.index=String(t);const c=document.createElement("div");if(c.className="tab-thumbnail",e.favIconUrl){const l=document.createElement("div");l.className="favicon-tile";const C=document.createElement("img");C.className="favicon-large",C.src=e.favIconUrl,C.alt="",C.onerror=()=>{l.textContent="";const I=document.createElement("div");I.className="favicon-letter",I.textContent=F(e.title),l.appendChild(I)},l.appendChild(C),c.appendChild(l)}else{const l=document.createElement("div");l.className="favicon-tile";const C=document.createElement("div");C.className="favicon-letter",C.textContent=F(e.title),l.appendChild(C),c.appendChild(l)}n.appendChild(c);const i=document.createElement("div");i.className="tab-info";const g=document.createElement("div");if(g.className="tab-title-row",e.favIconUrl){const l=document.createElement("img");l.className="tab-favicon",l.src=e.favIconUrl,l.alt="",l.onerror=()=>l.remove(),g.appendChild(l)}const y=document.createElement("span");y.className="tab-title",y.textContent=e.title||"Untitled",y.title=e.title||"Untitled",g.appendChild(y),i.appendChild(g);const E=document.createElement("div");E.className="tab-url",E.textContent=K(e.url),E.title=e.url||"",i.appendChild(E),n.appendChild(i);const x=document.createElement("button");return x.className="tab-close-btn restore-btn",x.appendChild(Y()),x.title="Restore tab",n.appendChild(x),n}n.className=`tab-card${e.pinned?" pinned":""}${e.active?" active-tab":""}`,n.dataset.tabId=String(e.id),n.dataset.index=String(t);const a=e.groupId&&e.groupId!==-1?G.find(c=>c.id===e.groupId):null;a&&(n.dataset.groupId=String(a.id),n.style.setProperty("--group-color",he(a.color)));const r=document.createElement("div");if(r.className="tab-thumbnail",e.screenshot){const c=document.createElement("img");c.className="screenshot-img",c.src=e.screenshot,c.alt="",c.loading="lazy",r.appendChild(c)}else{const c=document.createElement("div");if(c.className="favicon-tile",e.favIconUrl&&!e.favIconUrl.startsWith("chrome://")){const i=document.createElement("img");i.className="favicon-large",i.src=e.favIconUrl,i.alt="",i.onerror=()=>{c.textContent="";const g=document.createElement("div");g.className="favicon-letter",g.textContent=F(e.title),c.appendChild(g)},c.appendChild(i)}else{const i=document.createElement("div");i.className="favicon-letter",i.textContent=F(e.title),c.appendChild(i)}r.appendChild(c)}n.appendChild(r);const w=document.createElement("div");w.className="tab-info";const A=document.createElement("div");if(A.className="tab-title-row",e.favIconUrl&&!e.favIconUrl.startsWith("chrome://")){const c=document.createElement("img");c.className="tab-favicon",c.src=e.favIconUrl,c.alt="",c.onerror=()=>c.remove(),A.appendChild(c)}const P=document.createElement("span");P.className="tab-title",P.textContent=e.title||"Untitled",P.title=e.title||"Untitled",A.appendChild(P),w.appendChild(A);const D=document.createElement("div");D.className="tab-url",D.textContent=K(e.url),D.title=e.url||"",w.appendChild(D),n.appendChild(w);const M=document.createElement("button");if(M.className="tab-close-btn",M.appendChild(X()),M.title="Close tab",n.appendChild(M),e.audible&&!e.mutedInfo?.muted){const c=document.createElement("div");c.className="tab-audio-indicator",c.appendChild(ee()),n.appendChild(c)}else if(e.mutedInfo?.muted){const c=document.createElement("div");c.className="tab-audio-indicator muted",c.appendChild(te()),n.appendChild(c)}return n}function F(e){return(e.replace(/[^a-zA-Z0-9]/g,"")[0]||"T").toUpperCase()}function K(e){if(!e)return"";try{return new URL(e).hostname.replace(/^www\./,"")}catch{return e.slice(0,50)}}function he(e){const t={grey:"#5f6368",blue:"#1a73e8",red:"#d93025",yellow:"#f9ab00",green:"#1e8e3e",pink:"#d01884",purple:"#9334e6",cyan:"#007b83",orange:"#e8710a"};return t[e]||t.grey}document.addEventListener("DOMContentLoaded",ne);
